# Database Migration - Add Generated By Field

This directory contains the database migration to add the `generated_by` field to track who creates each quotation.

## Migration Files

- **`20260217_add_generated_by_field.sql`** - Original migration (for reference)
- **`run_migration_generated_by.sql`** - Safe migration with duplicate check (in database folder)
- **`RUN_GENERATED_BY_MIGRATION.bat`** - Windows batch script to run migration
- **`RUN_GENERATED_BY_MIGRATION.ps1`** - PowerShell script to run migration

## When to Run Migration

### For Fresh Docker Deployments
**No action needed!** The migration is automatically included in the Docker initialization scripts.

When you run `docker-compose up` for the first time, the migration will run automatically.

### For Existing Databases

If you already have a database running (local or Docker), you need to run the migration manually:

#### Option 1: Using Windows Batch Script
```cmd
cd bin
RUN_GENERATED_BY_MIGRATION.bat
```

#### Option 2: Using PowerShell
```powershell
cd bin
.\RUN_GENERATED_BY_MIGRATION.ps1
```

#### Option 3: Manual SQL Execution
```bash
psql -U postgres -d grp_quotation_fresh -f database/run_migration_generated_by.sql
```

#### Option 4: Docker Container
```bash
docker exec -i grp_postgres psql -U postgres -d grp_quotation_fresh < database/run_migration_generated_by.sql
```

## What This Migration Does

1. Adds `generated_by` VARCHAR(255) column to `quotation_webpage_input_details_save` table
2. Creates an index on `generated_by` for faster searches
3. Checks if column already exists to prevent errors on re-run

## Verification

After running the migration, verify it worked:

```sql
-- Check if column exists
SELECT column_name, data_type, is_nullable 
FROM information_schema.columns 
WHERE table_name = 'quotation_webpage_input_details_save' 
AND column_name = 'generated_by';

-- Check if index exists
SELECT indexname, indexdef 
FROM pg_indexes 
WHERE tablename = 'quotation_webpage_input_details_save' 
AND indexname = 'idx_quotation_generated_by';
```

## Rollback (if needed)

If you need to remove the column:

```sql
-- Remove index
DROP INDEX IF EXISTS idx_quotation_generated_by;

-- Remove column
ALTER TABLE quotation_webpage_input_details_save DROP COLUMN IF EXISTS generated_by;
```
